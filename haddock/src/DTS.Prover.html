<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# OPTIONS -Wall #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><a name="line-3"></a><span>
</span><a name="line-4"></a><span class="hs-comment">{-|
Module      : DTS.Prover
Copyright   : Daisuke Bekki
Licence     : All right reserved
Maintainer  : Daisuke Bekki &lt;bekki@is.ocha.ac.jp&gt;
Stability   : beta

A Prover-Interfaces for DTS.
-}</span><span>
</span><a name="line-13"></a><span>
</span><a name="line-14"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">DTS.Prover</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-15"></a><span>  </span><a href="DTS.Prover.html#defaultTypeCheck"><span class="hs-identifier hs-var">defaultTypeCheck</span></a><span class="hs-special">,</span><span>
</span><a name="line-16"></a><span>  </span><a href="DTS.Prover.html#defaultProofSearch"><span class="hs-identifier hs-var">defaultProofSearch</span></a><span class="hs-special">,</span><span>
</span><a name="line-17"></a><span>  </span><a href="DTS.Prover.html#checkFelicity"><span class="hs-identifier hs-var">checkFelicity</span></a><span class="hs-special">,</span><span>
</span><a name="line-18"></a><span>  </span><a href="DTS.Prover.html#checkEntailment"><span class="hs-identifier hs-var">checkEntailment</span></a><span>
</span><a name="line-19"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-20"></a><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Text.Lazy</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">T</span><span>      </span><span class="hs-comment">--text</span><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Text.Lazy.IO</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">T</span><span>   </span><span class="hs-comment">--text</span><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.List</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">L</span><span>           </span><span class="hs-comment">--base</span><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Parser.ChartParser.html"><span class="hs-identifier">Parser.ChartParser</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">CP</span><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Interface.HTML.html"><span class="hs-identifier">Interface.HTML</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">HTML</span><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="DTS.UDTT.html"><span class="hs-identifier">DTS.UDTT</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">UD</span><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="DTS.Prover.TypeChecker.html"><span class="hs-identifier">DTS.Prover.TypeChecker</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Ty</span><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="DTS.Prover.Judgement.html"><span class="hs-identifier">DTS.Prover.Judgement</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Ty</span><span>
</span><a name="line-29"></a><span>
</span><a name="line-30"></a><span class="hs-comment">-- | type check with the default signature = entity:type, evt:type</span><span>
</span><a name="line-31"></a><span class="hs-identifier">defaultTypeCheck</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DTS.UDTT.html#Signature"><span class="hs-identifier hs-type">UD.Signature</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DTS.UDTT.html#Context"><span class="hs-identifier hs-type">UD.Context</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DTS.UDTT.html#Preterm"><span class="hs-identifier hs-type">UD.Preterm</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DTS.UDTT.html#Preterm"><span class="hs-identifier hs-type">UD.Preterm</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="DTS.Prover.Judgement.html#UTree"><span class="hs-identifier hs-type">Ty.UTree</span></a><span> </span><a href="DTS.Prover.Judgement.html#UJudgement"><span class="hs-identifier hs-type">Ty.UJudgement</span></a><span class="hs-special">]</span><span>
</span><a name="line-32"></a><a name="defaultTypeCheck"><a href="DTS.Prover.html#defaultTypeCheck"><span class="hs-identifier">defaultTypeCheck</span></a></a><span> </span><a name="local-6989586621679090413"><a href="#local-6989586621679090413"><span class="hs-identifier">sig</span></a></a><span> </span><a name="local-6989586621679090414"><a href="#local-6989586621679090414"><span class="hs-identifier">cont</span></a></a><span> </span><a name="local-6989586621679090415"><a href="#local-6989586621679090415"><span class="hs-identifier">term</span></a></a><span> </span><a name="local-6989586621679090416"><a href="#local-6989586621679090416"><span class="hs-identifier">typ</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DTS.Prover.TypeChecker.html#typeCheckU"><span class="hs-identifier hs-var">Ty.typeCheckU</span></a><span> </span><a href="#local-6989586621679090414"><span class="hs-identifier hs-var">cont</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-string">&quot;evt&quot;</span><span class="hs-special">,</span><a href="DTS.UDTT.html#Type"><span class="hs-identifier hs-var">UD.Type</span></a><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-special">(</span><span class="hs-string">&quot;entity&quot;</span><span class="hs-special">,</span><a href="DTS.UDTT.html#Type"><span class="hs-identifier hs-var">UD.Type</span></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a href="#local-6989586621679090413"><span class="hs-identifier hs-var">sig</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679090415"><span class="hs-identifier hs-var">term</span></a><span> </span><a href="#local-6989586621679090416"><span class="hs-identifier hs-var">typ</span></a><span>
</span><a name="line-33"></a><span>
</span><a name="line-34"></a><span class="hs-comment">-- | proof search with the default signature = entity:type, evt:type</span><span>
</span><a name="line-35"></a><span class="hs-identifier">defaultProofSearch</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DTS.UDTT.html#Signature"><span class="hs-identifier hs-type">UD.Signature</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DTS.UDTT.html#Context"><span class="hs-identifier hs-type">UD.Context</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DTS.UDTT.html#Preterm"><span class="hs-identifier hs-type">UD.Preterm</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="DTS.Prover.Judgement.html#UTree"><span class="hs-identifier hs-type">Ty.UTree</span></a><span> </span><a href="DTS.Prover.Judgement.html#UJudgement"><span class="hs-identifier hs-type">Ty.UJudgement</span></a><span class="hs-special">]</span><span>
</span><a name="line-36"></a><a name="defaultProofSearch"><a href="DTS.Prover.html#defaultProofSearch"><span class="hs-identifier">defaultProofSearch</span></a></a><span> </span><a name="local-6989586621679090417"><a href="#local-6989586621679090417"><span class="hs-identifier">sig</span></a></a><span> </span><a name="local-6989586621679090418"><a href="#local-6989586621679090418"><span class="hs-identifier">cont</span></a></a><span> </span><a name="local-6989586621679090419"><a href="#local-6989586621679090419"><span class="hs-identifier">typ</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DTS.Prover.TypeChecker.html#proofSearch"><span class="hs-identifier hs-var">Ty.proofSearch</span></a><span> </span><a href="#local-6989586621679090418"><span class="hs-identifier hs-var">cont</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-string">&quot;evt&quot;</span><span class="hs-special">,</span><a href="DTS.UDTT.html#Type"><span class="hs-identifier hs-var">UD.Type</span></a><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-special">(</span><span class="hs-string">&quot;entity&quot;</span><span class="hs-special">,</span><a href="DTS.UDTT.html#Type"><span class="hs-identifier hs-var">UD.Type</span></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a href="#local-6989586621679090417"><span class="hs-identifier hs-var">sig</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679090419"><span class="hs-identifier hs-var">typ</span></a><span>
</span><a name="line-37"></a><span>
</span><a name="line-38"></a><span class="hs-comment">-- | checks felicity condition</span><span>
</span><a name="line-39"></a><span class="hs-identifier">checkFelicity</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DTS.UDTT.html#Signature"><span class="hs-identifier hs-type">UD.Signature</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="DTS.UDTT.html#Preterm"><span class="hs-identifier hs-type">UD.Preterm</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DTS.UDTT.html#Preterm"><span class="hs-identifier hs-type">UD.Preterm</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="DTS.Prover.Judgement.html#UTree"><span class="hs-identifier hs-type">Ty.UTree</span></a><span> </span><a href="DTS.Prover.Judgement.html#UJudgement"><span class="hs-identifier hs-type">Ty.UJudgement</span></a><span class="hs-special">]</span><span>
</span><a name="line-40"></a><a name="checkFelicity"><a href="DTS.Prover.html#checkFelicity"><span class="hs-identifier">checkFelicity</span></a></a><span> </span><a name="local-6989586621679090420"><a href="#local-6989586621679090420"><span class="hs-identifier">sig</span></a></a><span> </span><a name="local-6989586621679090421"><a href="#local-6989586621679090421"><span class="hs-identifier">cont</span></a></a><span> </span><a name="local-6989586621679090422"><a href="#local-6989586621679090422"><span class="hs-identifier">term</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DTS.Prover.html#defaultTypeCheck"><span class="hs-identifier hs-var">defaultTypeCheck</span></a><span> </span><a href="#local-6989586621679090420"><span class="hs-identifier hs-var">sig</span></a><span> </span><a href="#local-6989586621679090421"><span class="hs-identifier hs-var">cont</span></a><span> </span><a href="#local-6989586621679090422"><span class="hs-identifier hs-var">term</span></a><span> </span><span class="hs-special">(</span><a href="DTS.UDTT.html#Type"><span class="hs-identifier hs-var">UD.Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-41"></a><span>
</span><a name="line-42"></a><span class="hs-comment">-- | executes type check to a context</span><span>
</span><a name="line-43"></a><span class="hs-identifier">sequentialTypeCheck</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DTS.UDTT.html#Signature"><span class="hs-identifier hs-type">UD.Signature</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="DTS.UDTT.html#Preterm"><span class="hs-identifier hs-type">UD.Preterm</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="DTS.UDTT.html#Preterm"><span class="hs-identifier hs-type">UD.Preterm</span></a><span class="hs-special">]</span><span>
</span><a name="line-44"></a><a name="sequentialTypeCheck"><a href="DTS.Prover.html#sequentialTypeCheck"><span class="hs-identifier">sequentialTypeCheck</span></a></a><span> </span><a name="local-6989586621679090423"><a href="#local-6989586621679090423"><span class="hs-identifier">sig</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679090424"><a href="#local-6989586621679090424"><span class="hs-identifier">sr</span></a></a><span> </span><a name="local-6989586621679090425"><a href="#local-6989586621679090425"><span class="hs-identifier">cont</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679090426"><a href="#local-6989586621679090426"><span class="hs-identifier">result</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-45"></a><span>                                                          </span><a name="local-6989586621679090427"><a href="#local-6989586621679090427"><span class="hs-identifier">t1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DTS.Prover.html#checkFelicity"><span class="hs-identifier hs-var">checkFelicity</span></a><span> </span><a href="#local-6989586621679090423"><span class="hs-identifier hs-var">sig</span></a><span> </span><a href="#local-6989586621679090425"><span class="hs-identifier hs-var">cont</span></a><span> </span><a href="#local-6989586621679090424"><span class="hs-identifier hs-var">sr</span></a><span class="hs-special">;</span><span>
</span><a name="line-46"></a><span>                                                          </span><a name="local-6989586621679090428"><a href="#local-6989586621679090428"><span class="hs-identifier">t2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DTS.Prover.TypeChecker.html#aspElim"><span class="hs-identifier hs-var">Ty.aspElim</span></a><span> </span><a href="#local-6989586621679090427"><span class="hs-identifier hs-var">t1</span></a><span class="hs-special">;</span><span>
</span><a name="line-47"></a><span>                                                          </span><a name="local-6989586621679090429"><a href="#local-6989586621679090429"><span class="hs-identifier">t3</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DTS.Prover.Judgement.html#getTerm"><span class="hs-identifier hs-var">Ty.getTerm</span></a><span> </span><a href="#local-6989586621679090428"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-48"></a><span>                                                          </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="DTS.Prover.TypeChecker.html#repositP"><span class="hs-identifier hs-var">Ty.repositP</span></a><span> </span><a href="#local-6989586621679090429"><span class="hs-identifier hs-var">t3</span></a><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-49"></a><span>                                             </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679090426"><span class="hs-identifier hs-var">result</span></a><span>
</span><a name="line-50"></a><span>                                                </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><a href="DTS.UDTT.html#Con"><span class="hs-identifier hs-var">UD.Con</span></a><span> </span><span class="hs-string">&quot;Typecheck or aspElim failed&quot;</span><span class="hs-special">)</span><span class="hs-glyph">:</span><a href="#local-6989586621679090425"><span class="hs-identifier hs-var">cont</span></a><span>
</span><a name="line-51"></a><span>                                                </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679090426"><span class="hs-identifier hs-var">result</span></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a href="#local-6989586621679090425"><span class="hs-identifier hs-var">cont</span></a><span>
</span><a name="line-52"></a><span>                                </span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-53"></a><span>
</span><a name="line-54"></a><span class="hs-comment">-- | checks if premises entails hypothesis</span><span>
</span><a name="line-55"></a><span class="hs-identifier">checkEntailment</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>         </span><span class="hs-comment">-- ^ beam width</span><span>
</span><a name="line-56"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>      </span><span class="hs-comment">-- ^ n-best</span><span>
</span><a name="line-57"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">T.Text</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ premises</span><span>
</span><a name="line-58"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">T.Text</span><span>   </span><span class="hs-comment">-- ^ a hypothesis</span><span>
</span><a name="line-59"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-60"></a><a name="checkEntailment"><a href="DTS.Prover.html#checkEntailment"><span class="hs-identifier">checkEntailment</span></a></a><span> </span><a name="local-6989586621679090430"><a href="#local-6989586621679090430"><span class="hs-identifier">beam</span></a></a><span> </span><a name="local-6989586621679090431"><a href="#local-6989586621679090431"><span class="hs-identifier">nbest</span></a></a><span> </span><a name="local-6989586621679090432"><a href="#local-6989586621679090432"><span class="hs-identifier">premises</span></a></a><span> </span><a name="local-6989586621679090433"><a href="#local-6989586621679090433"><span class="hs-identifier">hypothesis</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-61"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679090434"><a href="#local-6989586621679090434"><span class="hs-identifier">hline</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;&lt;hr size='15' /&gt;&quot;</span><span>
</span><a name="line-62"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-63"></a><span>  </span><span class="hs-comment">-- Show premises and hypothesis</span><span>
</span><a name="line-64"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-65"></a><span>  </span><span class="hs-comment">--mapM_ T.putStr [&quot;[&quot;, jsem_id, &quot;]&quot;]</span><span>
</span><a name="line-66"></a><span>  </span><span class="hs-identifier hs-var">mapM_</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679090435"><a href="#local-6989586621679090435"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">mapM_</span><span> </span><span class="hs-identifier hs-var">T.putStr</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;&lt;p&gt;P: &quot;</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679090435"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;&lt;/p&gt;&quot;</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679090432"><span class="hs-identifier hs-var">premises</span></a><span>
</span><a name="line-67"></a><span>  </span><span class="hs-identifier hs-var">mapM_</span><span> </span><span class="hs-identifier hs-var">T.putStr</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;&lt;p&gt;H: &quot;</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679090433"><span class="hs-identifier hs-var">hypothesis</span></a><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;&lt;/p&gt;&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-68"></a><span>  </span><span class="hs-identifier hs-var">T.putStrLn</span><span> </span><a href="#local-6989586621679090434"><span class="hs-identifier hs-var">hline</span></a><span>
</span><a name="line-69"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-70"></a><span>  </span><span class="hs-comment">-- Parse sentences</span><span>
</span><a name="line-71"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-72"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679090436"><a href="#local-6989586621679090436"><span class="hs-identifier">sentences</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679090433"><span class="hs-identifier hs-var">hypothesis</span></a><span class="hs-glyph">:</span><span class="hs-special">(</span><span class="hs-identifier hs-var">reverse</span><span> </span><a href="#local-6989586621679090432"><span class="hs-identifier hs-var">premises</span></a><span class="hs-special">)</span><span>     </span><span class="hs-comment">-- reverse the order of sentences (hypothesis first, the first premise last)</span><span>
</span><a name="line-73"></a><span>  </span><a name="local-6989586621679090437"><a href="#local-6989586621679090437"><span class="hs-identifier">nodeslist</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="Parser.ChartParser.html#simpleParse"><span class="hs-identifier hs-var">CP.simpleParse</span></a><span> </span><a href="#local-6989586621679090430"><span class="hs-identifier hs-var">beam</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679090436"><span class="hs-identifier hs-var">sentences</span></a><span> </span><span class="hs-comment">-- parse sentences</span><span>
</span><a name="line-74"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679090438"><a href="#local-6989586621679090438"><span class="hs-identifier">pairslist</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679090441"><a href="#local-6989586621679090441"><span class="hs-identifier">node</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679090441"><span class="hs-identifier hs-var">node</span></a><span class="hs-special">,</span><span> </span><a href="DTS.UDTT.html#betaReduce"><span class="hs-identifier hs-var">UD.betaReduce</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="DTS.UDTT.html#sigmaElimination"><span class="hs-identifier hs-var">UD.sigmaElimination</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">CP.sem</span><span> </span><a href="#local-6989586621679090441"><span class="hs-identifier hs-var">node</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-operator hs-var">.</span><span class="hs-special">(</span><span class="hs-identifier hs-var">take</span><span> </span><a href="#local-6989586621679090431"><span class="hs-identifier hs-var">nbest</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679090437"><span class="hs-identifier hs-var">nodeslist</span></a><span class="hs-special">;</span><span>
</span><a name="line-75"></a><span>      </span><span class="hs-comment">-- Example: [[(nodeA1,srA1),(nodeA2,srA2)],[(nodeB1,srB1),(nodeB2,srB2)],[(nodeC1,srC1),(nodeC2,srC2)]]</span><span>
</span><a name="line-76"></a><span>      </span><span class="hs-comment">--          where sentences = A,B,C (where A is the hypothesis), nbest = 2_</span><span>
</span><a name="line-77"></a><span>      </span><a name="local-6989586621679090439"><a href="#local-6989586621679090439"><span class="hs-identifier">chosenlist</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DTS.Prover.html#choice"><span class="hs-identifier hs-var">choice</span></a><span> </span><a href="#local-6989586621679090438"><span class="hs-identifier hs-var">pairslist</span></a><span class="hs-special">;</span><span>
</span><a name="line-78"></a><span>      </span><span class="hs-comment">-- Example: [[(nodeA1,srA1),(nodeB1,srB1),(nodeC1,srC1)],[(nodeA1,srA1),(nodeB1,srB1),(nodeC2,srC2)],...]</span><span>
</span><a name="line-79"></a><span>      </span><a name="local-6989586621679090440"><a href="#local-6989586621679090440"><span class="hs-identifier">nodeSRlist</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">unzip</span><span> </span><a href="#local-6989586621679090439"><span class="hs-identifier hs-var">chosenlist</span></a><span class="hs-special">;</span><span>
</span><a name="line-80"></a><span>      </span><span class="hs-comment">-- Example: [([nodeA1,nodeB1,nodeC1],[srA1,srB1,srC1]),([nodeA1,nodeB1,nodeC2],[srA1,srB1,srC2]),...]</span><span>
</span><a name="line-81"></a><span>  </span><a name="local-6989586621679090449"><a href="#local-6989586621679090449"><span class="hs-identifier">tripledNodes</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679090442"><a href="#local-6989586621679090442"><span class="hs-identifier">nds</span></a></a><span class="hs-special">,</span><a name="local-6989586621679090443"><a href="#local-6989586621679090443"><span class="hs-identifier">srs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-82"></a><span>                         </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679090444"><a href="#local-6989586621679090444"><span class="hs-identifier">newsig</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl</span><span> </span><span class="hs-identifier hs-var">L.union</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier">CP.sig</span><span> </span><a href="#local-6989586621679090442"><span class="hs-identifier hs-var">nds</span></a><span class="hs-special">;</span><span>
</span><a name="line-83"></a><span>                             </span><a name="local-6989586621679090445"><a href="#local-6989586621679090445"><span class="hs-identifier">typecheckedSRs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DTS.Prover.html#sequentialTypeCheck"><span class="hs-identifier hs-var">sequentialTypeCheck</span></a><span> </span><a href="#local-6989586621679090444"><span class="hs-identifier hs-var">newsig</span></a><span> </span><a href="#local-6989586621679090443"><span class="hs-identifier hs-var">srs</span></a><span class="hs-special">;</span><span>
</span><a name="line-84"></a><span>                             </span><span class="hs-comment">-- Example: u0:srA1, u1:srB1, u2:srC1 (where A1 is the hyp.)</span><span>
</span><a name="line-85"></a><span>                             </span><span class="hs-comment">-- &#12371;&#12398;&#26178;&#28857;&#12391;&#19968;&#25991;&#30446;&#12399;typecheck of aspElim failed</span><span>
</span><a name="line-86"></a><span>                             </span><a name="local-6989586621679090446"><a href="#local-6989586621679090446"><span class="hs-identifier">proofdiagrams</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679090445"><span class="hs-identifier hs-var">typecheckedSRs</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-87"></a><span>                                               </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-88"></a><span>                                               </span><span class="hs-special">(</span><a name="local-6989586621679090447"><a href="#local-6989586621679090447"><span class="hs-identifier">hype</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679090448"><a href="#local-6989586621679090448"><span class="hs-identifier">prems</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DTS.Prover.html#defaultProofSearch"><span class="hs-identifier hs-var">defaultProofSearch</span></a><span> </span><a href="#local-6989586621679090444"><span class="hs-identifier hs-var">newsig</span></a><span> </span><a href="#local-6989586621679090448"><span class="hs-identifier hs-var">prems</span></a><span> </span><a href="#local-6989586621679090447"><span class="hs-identifier hs-var">hype</span></a><span class="hs-special">;</span><span>
</span><a name="line-89"></a><span>                         </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679090442"><span class="hs-identifier hs-var">nds</span></a><span class="hs-special">,</span><a href="#local-6989586621679090445"><span class="hs-identifier hs-var">typecheckedSRs</span></a><span class="hs-special">,</span><a href="#local-6989586621679090446"><span class="hs-identifier hs-var">proofdiagrams</span></a><span class="hs-special">)</span><span>
</span><a name="line-90"></a><span>                       </span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679090440"><span class="hs-identifier hs-var">nodeSRlist</span></a><span class="hs-special">;</span><span>
</span><a name="line-91"></a><span>  </span><span class="hs-comment">--S.hPutStrLn S.stderr $ show tripledNodes</span><span>
</span><a name="line-92"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679090450"><a href="#local-6989586621679090450"><span class="hs-identifier">nodeSrPrList</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">dropWhile</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679090454"><a href="#local-6989586621679090454"><span class="hs-identifier">p</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679090454"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679090449"><span class="hs-identifier hs-var">tripledNodes</span></a><span class="hs-special">;</span><span>
</span><a name="line-93"></a><span>      </span><span class="hs-special">(</span><a name="local-6989586621679090451"><a href="#local-6989586621679090451"><span class="hs-identifier">nds</span></a></a><span class="hs-special">,</span><a name="local-6989586621679090452"><a href="#local-6989586621679090452"><span class="hs-identifier">srs</span></a></a><span class="hs-special">,</span><a name="local-6989586621679090453"><a href="#local-6989586621679090453"><span class="hs-identifier">pds</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679090450"><span class="hs-identifier hs-var">nodeSrPrList</span></a><span>
</span><a name="line-94"></a><span>                        </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679090449"><span class="hs-identifier hs-var">tripledNodes</span></a><span>
</span><a name="line-95"></a><span>                        </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679090450"><span class="hs-identifier hs-var">nodeSrPrList</span></a><span>
</span><a name="line-96"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-97"></a><span>  </span><span class="hs-comment">-- Show parse trees</span><span>
</span><a name="line-98"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-99"></a><span>  </span><span class="hs-identifier hs-var">T.putStrLn</span><span> </span><a href="Interface.HTML.html#startMathML"><span class="hs-identifier hs-var">HTML.startMathML</span></a><span>
</span><a name="line-100"></a><span>  </span><span class="hs-identifier hs-var">mapM_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">T.putStrLn</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Interface.HTML.html#toMathML"><span class="hs-identifier hs-var">HTML.toMathML</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">reverse</span><span> </span><a href="#local-6989586621679090451"><span class="hs-identifier hs-var">nds</span></a><span>
</span><a name="line-101"></a><span>  </span><span class="hs-identifier hs-var">T.putStrLn</span><span> </span><a href="Interface.HTML.html#endMathML"><span class="hs-identifier hs-var">HTML.endMathML</span></a><span>
</span><a name="line-102"></a><span>  </span><span class="hs-identifier hs-var">T.putStrLn</span><span> </span><a href="#local-6989586621679090434"><span class="hs-identifier hs-var">hline</span></a><span>
</span><a name="line-103"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-104"></a><span>  </span><span class="hs-comment">-- Show proof diagrams</span><span>
</span><a name="line-105"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-106"></a><span>  </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679090453"><span class="hs-identifier hs-var">pds</span></a><span>
</span><a name="line-107"></a><span>     </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">mapM_</span><span> </span><span class="hs-identifier hs-var">T.putStrLn</span><span> </span><span class="hs-special">[</span><span>
</span><a name="line-108"></a><span>           </span><span class="hs-string">&quot;No proof diagrams for: &quot;</span><span class="hs-special">,</span><span>
</span><a name="line-109"></a><span>           </span><a href="Interface.HTML.html#startMathML"><span class="hs-identifier hs-var">HTML.startMathML</span></a><span class="hs-special">,</span><span>
</span><a name="line-110"></a><span>           </span><a href="DTS.UDTT.html#printProofSearchQuery"><span class="hs-identifier hs-var">UD.printProofSearchQuery</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tail</span><span> </span><a href="#local-6989586621679090452"><span class="hs-identifier hs-var">srs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679090452"><span class="hs-identifier hs-var">srs</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-111"></a><span>           </span><a href="Interface.HTML.html#endMathML"><span class="hs-identifier hs-var">HTML.endMathML</span></a><span>
</span><a name="line-112"></a><span>           </span><span class="hs-special">]</span><span>
</span><a name="line-113"></a><span>      </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-114"></a><span>           </span><span class="hs-identifier hs-var">T.putStrLn</span><span> </span><span class="hs-string">&quot;Proved: &quot;</span><span>
</span><a name="line-115"></a><span>           </span><span class="hs-identifier hs-var">T.putStrLn</span><span> </span><a href="Interface.HTML.html#startMathML"><span class="hs-identifier hs-var">HTML.startMathML</span></a><span>
</span><a name="line-116"></a><span>           </span><span class="hs-identifier hs-var">mapM_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">T.putStrLn</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="DTS.Prover.Judgement.html#utreeToMathML"><span class="hs-identifier hs-var">Ty.utreeToMathML</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679090453"><span class="hs-identifier hs-var">pds</span></a><span>
</span><a name="line-117"></a><span>           </span><span class="hs-identifier hs-var">T.putStrLn</span><span> </span><a href="Interface.HTML.html#endMathML"><span class="hs-identifier hs-var">HTML.endMathML</span></a><span>
</span><a name="line-118"></a><span>  </span><span class="hs-identifier hs-var">T.putStrLn</span><span> </span><a href="#local-6989586621679090434"><span class="hs-identifier hs-var">hline</span></a><span>
</span><a name="line-119"></a><span>
</span><a name="line-120"></a><span class="hs-identifier">choice</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="#local-6989586621679090412"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="#local-6989586621679090412"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-121"></a><a name="choice"><a href="DTS.Prover.html#choice"><span class="hs-identifier">choice</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-122"></a><span class="hs-identifier">choice</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679090455"><a href="#local-6989586621679090455"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">:</span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679090457"><span class="hs-identifier hs-var">x</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679090458"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679090457"><a href="#local-6989586621679090457"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679090455"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679090458"><a href="#local-6989586621679090458"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DTS.Prover.html#choice"><span class="hs-identifier hs-var">choice</span></a><span> </span><span class="hs-keyword">as</span><span class="hs-special">]</span><span>
</span><a name="line-123"></a></pre></body></html>
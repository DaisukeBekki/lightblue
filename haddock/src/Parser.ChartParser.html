<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# OPTIONS -Wall #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><a name="line-3"></a><span>
</span><a name="line-4"></a><span class="hs-comment">{-|
Module      : ChartParser
Copyright   : (c) Daisuke Bekki, 2016
Licence     : All right reserved
Maintainer  : Daisuke Bekki &lt;bekki@is.ocha.ac.jp&gt;
Stability   : beta

A left-corner CKY-parser for lexical grammars.
-}</span><span>
</span><a name="line-13"></a><span>
</span><a name="line-14"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Parser.ChartParser</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-15"></a><span>  </span><span class="hs-comment">-- * Data structures for CCG derivations</span><span>
</span><a name="line-16"></a><span>  </span><a href="Parser.ChartParser.html#Chart"><span class="hs-identifier hs-type">Chart</span></a><span class="hs-special">,</span><span>
</span><a name="line-17"></a><span>  </span><a href="Parser.CCG.html#Node"><span class="hs-identifier hs-type">CCG.Node</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-18"></a><span>  </span><span class="hs-comment">-- * Main parsing functions</span><span>
</span><a name="line-19"></a><span>  </span><a href="Parser.ChartParser.html#parse"><span class="hs-identifier hs-var">parse</span></a><span class="hs-special">,</span><span>
</span><a name="line-20"></a><span>  </span><a href="Parser.ChartParser.html#simpleParse"><span class="hs-identifier hs-var">simpleParse</span></a><span class="hs-special">,</span><span>
</span><a name="line-21"></a><span>  </span><span class="hs-comment">-- * Partial parsing function(s)</span><span>
</span><a name="line-22"></a><span>  </span><a href="Parser.ChartParser.html#ParseResult"><span class="hs-identifier hs-type">ParseResult</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-23"></a><span>  </span><a href="Parser.ChartParser.html#extractParseResult"><span class="hs-identifier hs-var">extractParseResult</span></a><span class="hs-special">,</span><span>
</span><a name="line-24"></a><span>  </span><span class="hs-comment">--bestOnly</span><span>
</span><a name="line-25"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-26"></a><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">L</span><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Char</span><span>                       </span><span class="hs-comment">--base</span><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Text.Lazy</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">T</span><span>   </span><span class="hs-comment">--text</span><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Map</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">M</span><span>         </span><span class="hs-comment">--container</span><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Parser.CCG.html"><span class="hs-identifier">Parser.CCG</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">CCG</span><span> </span><span class="hs-comment">--(Node, unaryRules, binaryRules, trinaryRules, isCONJ, cat, SimpleText)</span><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Parser.Japanese.Lexicon.html"><span class="hs-identifier">Parser.Japanese.Lexicon</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">L</span><span> </span><span class="hs-special">(</span><a href="Parser.Japanese.Lexicon.html#LexicalItems"><span class="hs-identifier hs-type">LexicalItems</span></a><span class="hs-special">,</span><span> </span><a href="Parser.Japanese.Lexicon.html#lookupLexicon"><span class="hs-identifier hs-var">lookupLexicon</span></a><span class="hs-special">,</span><span> </span><a href="Parser.Japanese.Lexicon.html#setupLexicon"><span class="hs-identifier hs-var">setupLexicon</span></a><span class="hs-special">,</span><span> </span><a href="Parser.Japanese.MyLexicon.html#emptyCategories"><span class="hs-identifier hs-var">emptyCategories</span></a><span class="hs-special">)</span><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Parser.Japanese.Templates.html"><span class="hs-identifier">Parser.Japanese.Templates</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">LT</span><span>
</span><a name="line-34"></a><span>
</span><a name="line-35"></a><span class="hs-comment">{- Main functions -}</span><span>
</span><a name="line-36"></a><span>
</span><a name="line-37"></a><span class="hs-comment">-- | The type for CYK-charts.</span><span>
</span><a name="line-38"></a><span class="hs-keyword">type</span><span> </span><a name="Chart"><a href="Parser.ChartParser.html#Chart"><span class="hs-identifier">Chart</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">M.Map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="Parser.CCG.html#Node"><span class="hs-identifier hs-type">CCG.Node</span></a><span class="hs-special">]</span><span>
</span><a name="line-39"></a><span>
</span><a name="line-40"></a><span class="hs-comment">-- | Main parsing function to parse a Japanees sentence and generates a CYK-chart.</span><span>
</span><a name="line-41"></a><span class="hs-identifier">parse</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>           </span><span class="hs-comment">-- ^ The beam width</span><span>
</span><a name="line-42"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">T.Text</span><span>     </span><span class="hs-comment">-- ^ A sentence to be parsed</span><span>
</span><a name="line-43"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span class="hs-special">(</span><a href="Parser.ChartParser.html#Chart"><span class="hs-identifier hs-type">Chart</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ A pair of the resulting CYK-chart and a list of CYK-charts for segments</span><span>
</span><a name="line-44"></a><a name="parse"><a href="Parser.ChartParser.html#parse"><span class="hs-identifier">parse</span></a></a><span> </span><a name="local-6989586621679088561"><a href="#local-6989586621679088561"><span class="hs-identifier">beam</span></a></a><span> </span><a name="local-6989586621679088562"><a href="#local-6989586621679088562"><span class="hs-identifier">sentence</span></a></a><span>
</span><a name="line-45"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679088562"><span class="hs-identifier hs-var">sentence</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">T.empty</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">M.empty</span><span> </span><span class="hs-comment">-- returns an empty chart, otherwise foldl returns a runtime error when text is empty</span><span>
</span><a name="line-46"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-47"></a><span>      </span><a name="local-6989586621679088563"><a href="#local-6989586621679088563"><span class="hs-identifier">lexicon</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Parser.Japanese.Lexicon.html#setupLexicon"><span class="hs-identifier hs-var">L.setupLexicon</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">T.replace</span><span> </span><span class="hs-string">&quot;&#8213;&quot;</span><span> </span><span class="hs-string">&quot;&#12290;&quot;</span><span> </span><a href="#local-6989586621679088562"><span class="hs-identifier hs-var">sentence</span></a><span class="hs-special">)</span><span>
</span><a name="line-48"></a><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679088564"><a href="#local-6989586621679088564"><span class="hs-identifier">chart</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">T.foldl'</span><span> </span><span class="hs-special">(</span><a href="Parser.ChartParser.html#chartAccumulator"><span class="hs-identifier hs-var">chartAccumulator</span></a><span> </span><a href="#local-6989586621679088561"><span class="hs-identifier hs-var">beam</span></a><span> </span><a href="#local-6989586621679088563"><span class="hs-identifier hs-var">lexicon</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">M.empty</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-number">0</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-number">0</span><span class="hs-special">,</span><span class="hs-identifier hs-var">T.empty</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Parser.ChartParser.html#purifyText"><span class="hs-identifier hs-var">purifyText</span></a><span> </span><a href="#local-6989586621679088562"><span class="hs-identifier hs-var">sentence</span></a><span class="hs-special">)</span><span>
</span><a name="line-49"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679088564"><span class="hs-identifier hs-var">chart</span></a><span>
</span><a name="line-50"></a><span>
</span><a name="line-51"></a><span class="hs-comment">-- | removes occurrences of non-letters from an input text.</span><span>
</span><a name="line-52"></a><span class="hs-identifier">purifyText</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">T.Text</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">T.Text</span><span>
</span><a name="line-53"></a><a name="purifyText"><a href="Parser.ChartParser.html#purifyText"><span class="hs-identifier">purifyText</span></a></a><span> </span><a name="local-6989586621679088565"><a href="#local-6989586621679088565"><span class="hs-identifier">text</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-54"></a><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">T.uncons</span><span> </span><a href="#local-6989586621679088565"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-comment">-- remove a non-literal symbol at the beginning of a sentence (if any)</span><span>
</span><a name="line-55"></a><span>    </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">T.empty</span><span>
</span><a name="line-56"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679088566"><a href="#local-6989586621679088566"><span class="hs-identifier">c</span></a></a><span class="hs-special">,</span><a name="local-6989586621679088567"><a href="#local-6989586621679088567"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isSpace</span><span> </span><a href="#local-6989586621679088566"><span class="hs-identifier hs-var">c</span></a><span>                                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Parser.ChartParser.html#purifyText"><span class="hs-identifier hs-var">purifyText</span></a><span> </span><a href="#local-6989586621679088567"><span class="hs-identifier hs-var">t</span></a><span>               </span><span class="hs-comment">-- ignore white spaces</span><span>
</span><a name="line-57"></a><span>               </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">T.any</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><a href="#local-6989586621679088566"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-string">&quot;&#65281;&#65311;!?&#8230;&#12300;&#12301;&#9678;&#9675;&#9679;&#9650;&#9651;&#9660;&#9661;&#9632;&#9633;&#9670;&#9671;&#9733;&#9734;&#8251;&#8224;&#8225;.&quot;</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Parser.ChartParser.html#purifyText"><span class="hs-identifier hs-var">purifyText</span></a><span> </span><a href="#local-6989586621679088567"><span class="hs-identifier hs-var">t</span></a><span>              </span><span class="hs-comment">-- ignore meaningless symbols</span><span>
</span><a name="line-58"></a><span>               </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">T.any</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><a href="#local-6989586621679088566"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-string">&quot;&#65292;,-&#8213;?&#65295;&#65340;&quot;</span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">T.cons</span><span> </span><span class="hs-char">'&#12289;'</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Parser.ChartParser.html#purifyText"><span class="hs-identifier hs-var">purifyText</span></a><span> </span><a href="#local-6989586621679088567"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-comment">-- punctuations</span><span>
</span><a name="line-59"></a><span>               </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">T.cons</span><span> </span><a href="#local-6989586621679088566"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Parser.ChartParser.html#purifyText"><span class="hs-identifier hs-var">purifyText</span></a><span> </span><a href="#local-6989586621679088567"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-60"></a><span>
</span><a name="line-61"></a><span class="hs-comment">-- | quadruples representing a state during parsing:</span><span>
</span><a name="line-62"></a><span class="hs-comment">-- the parsed result (Chart) of the left of the pivot,</span><span>
</span><a name="line-63"></a><span class="hs-comment">-- the stack of ending positions of the previous 'separators' (i.e. '&#12289;','&#65292;',etc), </span><span>
</span><a name="line-64"></a><span class="hs-comment">-- the pivot (=the current parsing position), and</span><span>
</span><a name="line-65"></a><span class="hs-comment">-- the revsersed list of chars that has been parsed</span><span>
</span><a name="line-66"></a><span class="hs-keyword">type</span><span> </span><a name="PartialChart"><a href="Parser.ChartParser.html#PartialChart"><span class="hs-identifier">PartialChart</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Parser.ChartParser.html#Chart"><span class="hs-identifier hs-type">Chart</span></a><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span class="hs-identifier hs-type">T.Text</span><span class="hs-special">)</span><span>
</span><a name="line-67"></a><span>
</span><a name="line-68"></a><span class="hs-comment">-- | The 'chartAccumulator' function is the accumulator of the 'parse' function</span><span>
</span><a name="line-69"></a><span class="hs-identifier">chartAccumulator</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>               </span><span class="hs-comment">-- ^ The beam width as the first parameter</span><span>
</span><a name="line-70"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Parser.Japanese.Lexicon.html#LexicalItems"><span class="hs-identifier hs-type">L.LexicalItems</span></a><span> </span><span class="hs-comment">-- ^ my lexicon as the second parameter</span><span>
</span><a name="line-71"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Parser.ChartParser.html#PartialChart"><span class="hs-identifier hs-type">PartialChart</span></a><span>   </span><span class="hs-comment">-- ^ The accumulated result, given</span><span>
</span><a name="line-72"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Char</span><span>           </span><span class="hs-comment">-- ^ The next char of a unparsed text</span><span>
</span><a name="line-73"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Parser.ChartParser.html#PartialChart"><span class="hs-identifier hs-type">PartialChart</span></a><span>   </span><span class="hs-comment">-- ^ The accumulated result, updated</span><span>
</span><a name="line-74"></a><a name="chartAccumulator"><a href="Parser.ChartParser.html#chartAccumulator"><span class="hs-identifier">chartAccumulator</span></a></a><span> </span><a name="local-6989586621679088876"><a href="#local-6989586621679088876"><span class="hs-identifier">beam</span></a></a><span> </span><a name="local-6989586621679088877"><a href="#local-6989586621679088877"><span class="hs-identifier">lexicon</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679088878"><a href="#local-6989586621679088878"><span class="hs-identifier">chart</span></a></a><span class="hs-special">,</span><a name="local-6989586621679088879"><a href="#local-6989586621679088879"><span class="hs-identifier">seplist</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679088880"><a href="#local-6989586621679088880"><span class="hs-identifier">sep</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679088881"><a href="#local-6989586621679088881"><span class="hs-identifier">seps</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><a name="local-6989586621679088882"><a href="#local-6989586621679088882"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><a name="local-6989586621679088883"><a href="#local-6989586621679088883"><span class="hs-identifier">stack</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679088884"><a href="#local-6989586621679088884"><span class="hs-identifier">c</span></a></a><span>
</span><a name="line-75"></a><span>  </span><span class="hs-comment">-- The case where the next Char is a punctuation. Recall that each seperator is an end of a phase</span><span>
</span><a name="line-76"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679088884"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-char">'&#12289;'</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679088885"><a href="#local-6989586621679088885"><span class="hs-identifier">newchart</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">M.fromList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679088882"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><a href="#local-6989586621679088882"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">[</span><a href="Parser.ChartParser.html#andCONJ"><span class="hs-identifier hs-var">andCONJ</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">T.singleton</span><span> </span><a href="#local-6989586621679088884"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Parser.ChartParser.html#emptyCM"><span class="hs-identifier hs-var">emptyCM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">T.singleton</span><span> </span><a href="#local-6989586621679088884"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-special">(</span><span class="hs-identifier hs-var">foldl'</span><span> </span><span class="hs-special">(</span><a href="Parser.ChartParser.html#punctFilter"><span class="hs-identifier hs-var">punctFilter</span></a><span> </span><a href="#local-6989586621679088880"><span class="hs-identifier hs-var">sep</span></a><span> </span><a href="#local-6989586621679088882"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">M.toList</span><span> </span><a href="#local-6989586621679088878"><span class="hs-identifier hs-var">chart</span></a><span class="hs-special">)</span><span class="hs-special">;</span><span>
</span><a name="line-77"></a><span>                    </span><a name="local-6989586621679088886"><a href="#local-6989586621679088886"><span class="hs-identifier">newstack</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">T.cons</span><span> </span><a href="#local-6989586621679088884"><span class="hs-identifier hs-var">c</span></a><span> </span><a href="#local-6989586621679088883"><span class="hs-identifier hs-var">stack</span></a><span>
</span><a name="line-78"></a><span>               </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679088885"><span class="hs-identifier hs-var">newchart</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679088882"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-glyph">:</span><a href="#local-6989586621679088879"><span class="hs-identifier hs-var">seplist</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679088882"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679088886"><span class="hs-identifier hs-var">newstack</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">--, (take 1 (sort (lookupChart sep (i+1) newchart)):parsed))</span><span>
</span><a name="line-79"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679088884"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-char">'&#12290;'</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679088887"><a href="#local-6989586621679088887"><span class="hs-identifier">newchart</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">M.fromList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span> </span><span class="hs-special">(</span><a href="Parser.ChartParser.html#punctFilter"><span class="hs-identifier hs-var">punctFilter</span></a><span> </span><a href="#local-6989586621679088880"><span class="hs-identifier hs-var">sep</span></a><span> </span><a href="#local-6989586621679088882"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">M.toList</span><span> </span><a href="#local-6989586621679088878"><span class="hs-identifier hs-var">chart</span></a><span class="hs-special">;</span><span>
</span><a name="line-80"></a><span>                    </span><a name="local-6989586621679088888"><a href="#local-6989586621679088888"><span class="hs-identifier">newstack</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">T.cons</span><span> </span><a href="#local-6989586621679088884"><span class="hs-identifier hs-var">c</span></a><span> </span><a href="#local-6989586621679088883"><span class="hs-identifier hs-var">stack</span></a><span>
</span><a name="line-81"></a><span>               </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679088887"><span class="hs-identifier hs-var">newchart</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679088882"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-glyph">:</span><a href="#local-6989586621679088879"><span class="hs-identifier hs-var">seplist</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679088882"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679088888"><span class="hs-identifier hs-var">newstack</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">--, (take 1 (sort (lookupChart sep (i+1) newchart)):parsed))</span><span>
</span><a name="line-82"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-83"></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679088889"><a href="#local-6989586621679088889"><span class="hs-identifier">newstack</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">T.cons</span><span> </span><a href="#local-6989586621679088884"><span class="hs-identifier hs-var">c</span></a><span> </span><a href="#local-6989586621679088883"><span class="hs-identifier hs-var">stack</span></a><span class="hs-special">)</span><span class="hs-special">;</span><span>
</span><a name="line-84"></a><span>           </span><span class="hs-special">(</span><a name="local-6989586621679088890"><a href="#local-6989586621679088890"><span class="hs-identifier">newchart</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">T.foldl'</span><span> </span><span class="hs-special">(</span><a href="Parser.ChartParser.html#boxAccumulator"><span class="hs-identifier hs-var">boxAccumulator</span></a><span> </span><a href="#local-6989586621679088876"><span class="hs-identifier hs-var">beam</span></a><span> </span><a href="#local-6989586621679088877"><span class="hs-identifier hs-var">lexicon</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679088878"><span class="hs-identifier hs-var">chart</span></a><span class="hs-special">,</span><span class="hs-identifier hs-var">T.empty</span><span class="hs-special">,</span><a href="#local-6989586621679088882"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><a href="#local-6989586621679088882"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679088889"><span class="hs-identifier hs-var">newstack</span></a><span class="hs-special">;</span><span>
</span><a name="line-85"></a><span>           </span><a name="local-6989586621679088891"><a href="#local-6989586621679088891"><span class="hs-identifier">newseps</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679088884"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><span class="hs-special">[</span><span class="hs-char">'&#12300;'</span><span class="hs-special">,</span><span class="hs-char">'&#12302;'</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679088882"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-glyph">:</span><a href="#local-6989586621679088879"><span class="hs-identifier hs-var">seplist</span></a><span class="hs-special">)</span><span>
</span><a name="line-86"></a><span>                   </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679088884"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><span class="hs-special">[</span><span class="hs-char">'&#12301;'</span><span class="hs-special">,</span><span class="hs-char">'&#12303;'</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679088881"><span class="hs-identifier hs-var">seps</span></a><span>
</span><a name="line-87"></a><span>                   </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679088879"><span class="hs-identifier hs-var">seplist</span></a><span>
</span><a name="line-88"></a><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679088890"><span class="hs-identifier hs-var">newchart</span></a><span class="hs-special">,</span><a href="#local-6989586621679088891"><span class="hs-identifier hs-var">newseps</span></a><span class="hs-special">,</span><span class="hs-special">(</span><a href="#local-6989586621679088882"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">,</span><a href="#local-6989586621679088889"><span class="hs-identifier hs-var">newstack</span></a><span class="hs-special">)</span><span>
</span><a name="line-89"></a><span class="hs-comment">-- chartAccumulator _ _ (_,[],_,_) _ = ?</span><span>
</span><a name="line-90"></a><span>
</span><a name="line-91"></a><span class="hs-comment">-- | </span><span>
</span><a name="line-92"></a><span class="hs-identifier">punctFilter</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>    </span><span class="hs-comment">-- ^ Previous pivot</span><span>
</span><a name="line-93"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ Current pivot</span><span>
</span><a name="line-94"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">[</span><a href="Parser.CCG.html#Node"><span class="hs-identifier hs-type">CCG.Node</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ The list of nodes that has been endorced</span><span>
</span><a name="line-95"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">[</span><a href="Parser.CCG.html#Node"><span class="hs-identifier hs-type">CCG.Node</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- ^ With respect to a given entry (=e@((from,to),nodes)), </span><span>
</span><a name="line-96"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">[</span><a href="Parser.CCG.html#Node"><span class="hs-identifier hs-type">CCG.Node</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-97"></a><a name="punctFilter"><a href="Parser.ChartParser.html#punctFilter"><span class="hs-identifier">punctFilter</span></a></a><span> </span><a name="local-6989586621679088892"><a href="#local-6989586621679088892"><span class="hs-identifier">sep</span></a></a><span> </span><a name="local-6989586621679088893"><a href="#local-6989586621679088893"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621679088894"><a href="#local-6989586621679088894"><span class="hs-identifier">charList</span></a></a><span> </span><a name="local-6989586621679088895"><a href="#local-6989586621679088895"><span class="hs-identifier">e</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679088896"><a href="#local-6989586621679088896"><span class="hs-identifier">from</span></a></a><span class="hs-special">,</span><a name="local-6989586621679088897"><a href="#local-6989586621679088897"><span class="hs-identifier">to</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><a name="local-6989586621679088898"><a href="#local-6989586621679088898"><span class="hs-identifier">nodes</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-98"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679088897"><span class="hs-identifier hs-var">to</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679088893"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679088896"><span class="hs-identifier hs-var">from</span></a><span class="hs-special">,</span><a href="#local-6989586621679088897"><span class="hs-identifier hs-var">to</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><a href="Parser.CCG.html#isBunsetsu"><span class="hs-identifier hs-var">CCG.isBunsetsu</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">CCG.cat</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679088898"><span class="hs-identifier hs-var">nodes</span></a><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-special">(</span><a href="#local-6989586621679088895"><span class="hs-identifier hs-var">e</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679088894"><span class="hs-identifier hs-var">charList</span></a><span class="hs-special">)</span><span>
</span><a name="line-99"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679088895"><span class="hs-identifier hs-var">e</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679088894"><span class="hs-identifier hs-var">charList</span></a><span>
</span><a name="line-100"></a><span>                </span><span class="hs-comment">-- if from &lt;= sep</span><span>
</span><a name="line-101"></a><span>                </span><span class="hs-comment">--    then e:charList</span><span>
</span><a name="line-102"></a><span>                </span><span class="hs-comment">--    else charList</span><span>
</span><a name="line-103"></a><span>
</span><a name="line-104"></a><span class="hs-identifier">andCONJ</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">T.Text</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Parser.CCG.html#Node"><span class="hs-identifier hs-type">CCG.Node</span></a><span>
</span><a name="line-105"></a><a name="andCONJ"><a href="Parser.ChartParser.html#andCONJ"><span class="hs-identifier">andCONJ</span></a></a><span> </span><a name="local-6989586621679088899"><a href="#local-6989586621679088899"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Parser.Japanese.Templates.html#lexicalitem"><span class="hs-identifier hs-var">LT.lexicalitem</span></a><span> </span><a href="#local-6989586621679088899"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-string">&quot;punct&quot;</span><span> </span><span class="hs-number">100</span><span> </span><a href="Parser.CCG.html#CONJ"><span class="hs-identifier hs-var">CCG.CONJ</span></a><span> </span><a href="Parser.Japanese.Templates.html#andSR"><span class="hs-identifier hs-var">LT.andSR</span></a><span>
</span><a name="line-106"></a><span>
</span><a name="line-107"></a><span class="hs-identifier">emptyCM</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">T.Text</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Parser.CCG.html#Node"><span class="hs-identifier hs-type">CCG.Node</span></a><span>
</span><a name="line-108"></a><a name="emptyCM"><a href="Parser.ChartParser.html#emptyCM"><span class="hs-identifier">emptyCM</span></a></a><span> </span><a name="local-6989586621679088900"><a href="#local-6989586621679088900"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Parser.Japanese.Templates.html#lexicalitem"><span class="hs-identifier hs-var">LT.lexicalitem</span></a><span> </span><a href="#local-6989586621679088900"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-string">&quot;punct&quot;</span><span> </span><span class="hs-number">99</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">(</span><a href="Parser.CCG.html#T"><span class="hs-identifier hs-var">CCG.T</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-number">1</span><span> </span><a href="Parser.Japanese.Templates.html#modifiableS"><span class="hs-identifier hs-var">LT.modifiableS</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="Parser.CCG.html#SL"><span class="hs-identifier hs-var">CCG.SL</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="Parser.CCG.html#T"><span class="hs-identifier hs-var">CCG.T</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-number">1</span><span> </span><a href="Parser.Japanese.Templates.html#modifiableS"><span class="hs-identifier hs-var">LT.modifiableS</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="Parser.CCG.html#BS"><span class="hs-identifier hs-var">CCG.BS</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="Parser.CCG.html#NP"><span class="hs-identifier hs-var">CCG.NP</span></a><span> </span><span class="hs-special">[</span><a href="Parser.CCG.html#F"><span class="hs-identifier hs-var">CCG.F</span></a><span class="hs-special">[</span><a href="Parser.CCG.html#Ga"><span class="hs-identifier hs-var">CCG.Ga</span></a><span class="hs-special">,</span><a href="Parser.CCG.html#O"><span class="hs-identifier hs-var">CCG.O</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="Parser.CCG.html#BS"><span class="hs-identifier hs-var">CCG.BS</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="Parser.CCG.html#NP"><span class="hs-identifier hs-var">CCG.NP</span></a><span> </span><span class="hs-special">[</span><a href="Parser.CCG.html#F"><span class="hs-identifier hs-var">CCG.F</span></a><span class="hs-special">[</span><a href="Parser.CCG.html#Nc"><span class="hs-identifier hs-var">CCG.Nc</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="Parser.Japanese.Templates.html#argumentCM"><span class="hs-identifier hs-var">LT.argumentCM</span></a><span>
</span><a name="line-109"></a><span>
</span><a name="line-110"></a><span class="hs-keyword">type</span><span> </span><a name="PartialBox"><a href="Parser.ChartParser.html#PartialBox"><span class="hs-identifier">PartialBox</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Parser.ChartParser.html#Chart"><span class="hs-identifier hs-type">Chart</span></a><span class="hs-special">,</span><span class="hs-identifier hs-type">T.Text</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span>
</span><a name="line-111"></a><span>
</span><a name="line-112"></a><span class="hs-comment">-- | The 'boxAccumulator' function</span><span>
</span><a name="line-113"></a><span class="hs-identifier">boxAccumulator</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>               </span><span class="hs-comment">-- ^ beam width</span><span>
</span><a name="line-114"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Parser.Japanese.Lexicon.html#LexicalItems"><span class="hs-identifier hs-type">L.LexicalItems</span></a><span> </span><span class="hs-comment">-- ^ my lexicon</span><span>
</span><a name="line-115"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Parser.ChartParser.html#PartialBox"><span class="hs-identifier hs-type">PartialBox</span></a><span>     </span><span class="hs-comment">-- ^ accumulated result (Chart, Text, Int, Int)</span><span>
</span><a name="line-116"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Char</span><span>           </span><span class="hs-comment">-- ^ </span><span>
</span><a name="line-117"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Parser.ChartParser.html#PartialBox"><span class="hs-identifier hs-type">PartialBox</span></a><span>
</span><a name="line-118"></a><a name="boxAccumulator"><a href="Parser.ChartParser.html#boxAccumulator"><span class="hs-identifier">boxAccumulator</span></a></a><span> </span><a name="local-6989586621679088901"><a href="#local-6989586621679088901"><span class="hs-identifier">beam</span></a></a><span> </span><a name="local-6989586621679088902"><a href="#local-6989586621679088902"><span class="hs-identifier">lexicon</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679088903"><a href="#local-6989586621679088903"><span class="hs-identifier">chart</span></a></a><span class="hs-special">,</span><a name="local-6989586621679088904"><a href="#local-6989586621679088904"><span class="hs-identifier">word</span></a></a><span class="hs-special">,</span><a name="local-6989586621679088905"><a href="#local-6989586621679088905"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><a name="local-6989586621679088906"><a href="#local-6989586621679088906"><span class="hs-identifier">j</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679088907"><a href="#local-6989586621679088907"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-119"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679088908"><a href="#local-6989586621679088908"><span class="hs-identifier">newword</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">T.cons</span><span> </span><a href="#local-6989586621679088907"><span class="hs-identifier hs-var">c</span></a><span> </span><a href="#local-6989586621679088904"><span class="hs-identifier hs-var">word</span></a><span class="hs-special">;</span><span>
</span><a name="line-120"></a><span>      </span><a name="local-6989586621679088909"><a href="#local-6989586621679088909"><span class="hs-identifier">list0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">T.compareLength</span><span> </span><a href="#local-6989586621679088908"><span class="hs-identifier hs-var">newword</span></a><span> </span><span class="hs-number">23</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">LT</span><span>
</span><a name="line-121"></a><span>                </span><span class="hs-comment">-- Does not execute lookup for a long word. Run &quot;LongestWord&quot; to check that the length of the longest word (=23).</span><span>
</span><a name="line-122"></a><span>                </span><span class="hs-keyword">then</span><span> </span><a href="Parser.Japanese.Lexicon.html#lookupLexicon"><span class="hs-identifier hs-var">L.lookupLexicon</span></a><span> </span><a href="#local-6989586621679088908"><span class="hs-identifier hs-var">newword</span></a><span> </span><a href="#local-6989586621679088902"><span class="hs-identifier hs-var">lexicon</span></a><span>
</span><a name="line-123"></a><span>                </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">;</span><span>
</span><a name="line-124"></a><span>      </span><a name="local-6989586621679088910"><a href="#local-6989586621679088910"><span class="hs-identifier">list1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Parser.ChartParser.html#checkEmptyCategories"><span class="hs-identifier hs-var">checkEmptyCategories</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Parser.ChartParser.html#checkParenthesisRule"><span class="hs-identifier hs-var">checkParenthesisRule</span></a><span> </span><a href="#local-6989586621679088905"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679088906"><span class="hs-identifier hs-var">j</span></a><span> </span><a href="#local-6989586621679088903"><span class="hs-identifier hs-var">chart</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Parser.ChartParser.html#checkCoordinationRule"><span class="hs-identifier hs-var">checkCoordinationRule</span></a><span> </span><a href="#local-6989586621679088905"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679088906"><span class="hs-identifier hs-var">j</span></a><span> </span><a href="#local-6989586621679088903"><span class="hs-identifier hs-var">chart</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Parser.ChartParser.html#checkBinaryRules"><span class="hs-identifier hs-var">checkBinaryRules</span></a><span> </span><a href="#local-6989586621679088905"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679088906"><span class="hs-identifier hs-var">j</span></a><span> </span><a href="#local-6989586621679088903"><span class="hs-identifier hs-var">chart</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Parser.ChartParser.html#checkUnaryRules"><span class="hs-identifier hs-var">checkUnaryRules</span></a><span> </span><a href="#local-6989586621679088909"><span class="hs-identifier hs-var">list0</span></a><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-125"></a><span>  </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-var">M.insert</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679088905"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><a href="#local-6989586621679088906"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">take</span><span> </span><a href="#local-6989586621679088901"><span class="hs-identifier hs-var">beam</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">L.sort</span><span> </span><a href="#local-6989586621679088910"><span class="hs-identifier hs-var">list1</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679088903"><span class="hs-identifier hs-var">chart</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679088908"><span class="hs-identifier hs-var">newword</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679088905"><span class="hs-identifier hs-var">i</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679088906"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">)</span><span>
</span><a name="line-126"></a><span>  </span><span class="hs-comment">--((M.insert (i,j) (cutoff (max (beam+i-j) 24) list1) chart), newword, i-1, j)</span><span>
</span><a name="line-127"></a><span>
</span><a name="line-128"></a><span class="hs-comment">-- | take `beam` nodes from the top of `ndoes`.</span><span>
</span><a name="line-129"></a><span class="hs-comment">--cutoff :: Int -&gt; [CCG.Node] -&gt; [CCG.Node]</span><span>
</span><a name="line-130"></a><span class="hs-comment">--cutoff beam nodes = if length nodes &lt;= beam then nodes else take beam $ sort nodes</span><span>
</span><a name="line-131"></a><span>
</span><a name="line-132"></a><span class="hs-comment">-- | looks up a chart with the key (i,j) and returns the value of type [Node]</span><span>
</span><a name="line-133"></a><span class="hs-identifier">lookupChart</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Parser.ChartParser.html#Chart"><span class="hs-identifier hs-type">Chart</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Parser.CCG.html#Node"><span class="hs-identifier hs-type">CCG.Node</span></a><span class="hs-special">]</span><span>
</span><a name="line-134"></a><a name="lookupChart"><a href="Parser.ChartParser.html#lookupChart"><span class="hs-identifier">lookupChart</span></a></a><span> </span><a name="local-6989586621679088911"><a href="#local-6989586621679088911"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621679088912"><a href="#local-6989586621679088912"><span class="hs-identifier">j</span></a></a><span> </span><a name="local-6989586621679088913"><a href="#local-6989586621679088913"><span class="hs-identifier">chart</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-135"></a><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">M.lookup</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679088911"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><a href="#local-6989586621679088912"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679088913"><span class="hs-identifier hs-var">chart</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679088914"><a href="#local-6989586621679088914"><span class="hs-identifier">list</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679088914"><span class="hs-identifier hs-var">list</span></a><span>
</span><a name="line-136"></a><span>                                 </span><span class="hs-identifier hs-var">Nothing</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-137"></a><span class="hs-identifier">checkUnaryRules</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Parser.CCG.html#Node"><span class="hs-identifier hs-type">CCG.Node</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Parser.CCG.html#Node"><span class="hs-identifier hs-type">CCG.Node</span></a><span class="hs-special">]</span><span>
</span><a name="line-138"></a><a name="checkUnaryRules"><a href="Parser.ChartParser.html#checkUnaryRules"><span class="hs-identifier">checkUnaryRules</span></a></a><span> </span><a name="local-6989586621679088915"><a href="#local-6989586621679088915"><span class="hs-identifier">prevlist</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-139"></a><span>  </span><span class="hs-identifier hs-var">foldl'</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679088916"><a href="#local-6989586621679088916"><span class="hs-identifier">acc</span></a></a><span> </span><a name="local-6989586621679088917"><a href="#local-6989586621679088917"><span class="hs-identifier">node</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Parser.CCG.html#unaryRules"><span class="hs-identifier hs-var">CCG.unaryRules</span></a><span> </span><a href="#local-6989586621679088917"><span class="hs-identifier hs-var">node</span></a><span> </span><a href="#local-6989586621679088916"><span class="hs-identifier hs-var">acc</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679088915"><span class="hs-identifier hs-var">prevlist</span></a><span> </span><a href="#local-6989586621679088915"><span class="hs-identifier hs-var">prevlist</span></a><span>
</span><a name="line-140"></a><span>
</span><a name="line-141"></a><span class="hs-identifier">checkBinaryRules</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Parser.ChartParser.html#Chart"><span class="hs-identifier hs-type">Chart</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Parser.CCG.html#Node"><span class="hs-identifier hs-type">CCG.Node</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Parser.CCG.html#Node"><span class="hs-identifier hs-type">CCG.Node</span></a><span class="hs-special">]</span><span>
</span><a name="line-142"></a><a name="checkBinaryRules"><a href="Parser.ChartParser.html#checkBinaryRules"><span class="hs-identifier">checkBinaryRules</span></a></a><span> </span><a name="local-6989586621679088918"><a href="#local-6989586621679088918"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621679088919"><a href="#local-6989586621679088919"><span class="hs-identifier">j</span></a></a><span> </span><a name="local-6989586621679088920"><a href="#local-6989586621679088920"><span class="hs-identifier">chart</span></a></a><span> </span><a name="local-6989586621679088921"><a href="#local-6989586621679088921"><span class="hs-identifier">prevlist</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-143"></a><span>  </span><span class="hs-identifier hs-var">foldl'</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679088922"><a href="#local-6989586621679088922"><span class="hs-identifier">acck</span></a></a><span> </span><a name="local-6989586621679088923"><a href="#local-6989586621679088923"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679088924"><a href="#local-6989586621679088924"><span class="hs-identifier">accl</span></a></a><span> </span><a name="local-6989586621679088925"><a href="#local-6989586621679088925"><span class="hs-identifier">lnode</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679088926"><a href="#local-6989586621679088926"><span class="hs-identifier">accr</span></a></a><span> </span><a name="local-6989586621679088927"><a href="#local-6989586621679088927"><span class="hs-identifier">rnode</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Parser.CCG.html#binaryRules"><span class="hs-identifier hs-var">CCG.binaryRules</span></a><span> </span><a href="#local-6989586621679088925"><span class="hs-identifier hs-var">lnode</span></a><span> </span><a href="#local-6989586621679088927"><span class="hs-identifier hs-var">rnode</span></a><span> </span><a href="#local-6989586621679088926"><span class="hs-identifier hs-var">accr</span></a><span class="hs-special">)</span><span>
</span><a name="line-144"></a><span>                                                   </span><a href="#local-6989586621679088924"><span class="hs-identifier hs-var">accl</span></a><span>
</span><a name="line-145"></a><span>                                                   </span><span class="hs-special">(</span><a href="Parser.ChartParser.html#lookupChart"><span class="hs-identifier hs-var">lookupChart</span></a><span> </span><a href="#local-6989586621679088923"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679088919"><span class="hs-identifier hs-var">j</span></a><span> </span><a href="#local-6989586621679088920"><span class="hs-identifier hs-var">chart</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-146"></a><span>                            </span><a href="#local-6989586621679088922"><span class="hs-identifier hs-var">acck</span></a><span>
</span><a name="line-147"></a><span>                            </span><span class="hs-special">(</span><a href="Parser.ChartParser.html#lookupChart"><span class="hs-identifier hs-var">lookupChart</span></a><span> </span><a href="#local-6989586621679088918"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679088923"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679088920"><span class="hs-identifier hs-var">chart</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-148"></a><span>         </span><a href="#local-6989586621679088921"><span class="hs-identifier hs-var">prevlist</span></a><span>
</span><a name="line-149"></a><span>         </span><span class="hs-special">(</span><span class="hs-identifier hs-var">take</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679088919"><span class="hs-identifier hs-var">j</span></a><span class="hs-glyph">-</span><a href="#local-6989586621679088918"><span class="hs-identifier hs-var">i</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679088918"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-glyph">..</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- [k | i&lt;k&lt;j]</span><span>
</span><a name="line-150"></a><span>
</span><a name="line-151"></a><span class="hs-identifier">checkCoordinationRule</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Parser.ChartParser.html#Chart"><span class="hs-identifier hs-type">Chart</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Parser.CCG.html#Node"><span class="hs-identifier hs-type">CCG.Node</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Parser.CCG.html#Node"><span class="hs-identifier hs-type">CCG.Node</span></a><span class="hs-special">]</span><span>
</span><a name="line-152"></a><a name="checkCoordinationRule"><a href="Parser.ChartParser.html#checkCoordinationRule"><span class="hs-identifier">checkCoordinationRule</span></a></a><span> </span><a name="local-6989586621679088928"><a href="#local-6989586621679088928"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621679088929"><a href="#local-6989586621679088929"><span class="hs-identifier">j</span></a></a><span> </span><a name="local-6989586621679088930"><a href="#local-6989586621679088930"><span class="hs-identifier">chart</span></a></a><span> </span><a name="local-6989586621679088931"><a href="#local-6989586621679088931"><span class="hs-identifier">prevlist</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-153"></a><span>  </span><span class="hs-identifier hs-var">foldl'</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679088932"><a href="#local-6989586621679088932"><span class="hs-identifier">acck</span></a></a><span> </span><a name="local-6989586621679088933"><a href="#local-6989586621679088933"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679088934"><a href="#local-6989586621679088934"><span class="hs-identifier">accc</span></a></a><span> </span><a name="local-6989586621679088935"><a href="#local-6989586621679088935"><span class="hs-identifier">cnode</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679088936"><a href="#local-6989586621679088936"><span class="hs-identifier">accl</span></a></a><span> </span><a name="local-6989586621679088937"><a href="#local-6989586621679088937"><span class="hs-identifier">lnode</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679088938"><a href="#local-6989586621679088938"><span class="hs-identifier">accr</span></a></a><span> </span><a name="local-6989586621679088939"><a href="#local-6989586621679088939"><span class="hs-identifier">rnode</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Parser.CCG.html#coordinationRule"><span class="hs-identifier hs-var">CCG.coordinationRule</span></a><span> </span><a href="#local-6989586621679088937"><span class="hs-identifier hs-var">lnode</span></a><span> </span><a href="#local-6989586621679088935"><span class="hs-identifier hs-var">cnode</span></a><span> </span><a href="#local-6989586621679088939"><span class="hs-identifier hs-var">rnode</span></a><span> </span><a href="#local-6989586621679088938"><span class="hs-identifier hs-var">accr</span></a><span class="hs-special">)</span><span>
</span><a name="line-154"></a><span>                                                                          </span><a href="#local-6989586621679088936"><span class="hs-identifier hs-var">accl</span></a><span>
</span><a name="line-155"></a><span>                                                                          </span><span class="hs-special">(</span><a href="Parser.ChartParser.html#lookupChart"><span class="hs-identifier hs-var">lookupChart</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679088933"><span class="hs-identifier hs-var">k</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679088929"><span class="hs-identifier hs-var">j</span></a><span> </span><a href="#local-6989586621679088930"><span class="hs-identifier hs-var">chart</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-156"></a><span>                                                   </span><a href="#local-6989586621679088934"><span class="hs-identifier hs-var">accc</span></a><span>
</span><a name="line-157"></a><span>                                                   </span><span class="hs-special">(</span><a href="Parser.ChartParser.html#lookupChart"><span class="hs-identifier hs-var">lookupChart</span></a><span> </span><a href="#local-6989586621679088928"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679088933"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679088930"><span class="hs-identifier hs-var">chart</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-158"></a><span>                            </span><a href="#local-6989586621679088932"><span class="hs-identifier hs-var">acck</span></a><span>
</span><a name="line-159"></a><span>                            </span><span class="hs-special">(</span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679088940"><a href="#local-6989586621679088940"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">CCG.cat</span><span> </span><a href="#local-6989586621679088940"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span class="hs-operator hs-var">==</span><a href="Parser.CCG.html#CONJ"><span class="hs-identifier hs-var">CCG.CONJ</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Parser.ChartParser.html#lookupChart"><span class="hs-identifier hs-var">lookupChart</span></a><span> </span><a href="#local-6989586621679088933"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679088933"><span class="hs-identifier hs-var">k</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679088930"><span class="hs-identifier hs-var">chart</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-160"></a><span>         </span><a href="#local-6989586621679088931"><span class="hs-identifier hs-var">prevlist</span></a><span>
</span><a name="line-161"></a><span>         </span><span class="hs-special">(</span><span class="hs-identifier hs-var">take</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679088929"><span class="hs-identifier hs-var">j</span></a><span class="hs-glyph">-</span><a href="#local-6989586621679088928"><span class="hs-identifier hs-var">i</span></a><span class="hs-glyph">-</span><span class="hs-number">2</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679088928"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-glyph">..</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- [k | i&lt;k&lt;j-1]  i-k k-k+1 k+1-j</span><span>
</span><a name="line-162"></a><span>
</span><a name="line-163"></a><span class="hs-identifier">checkParenthesisRule</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Parser.ChartParser.html#Chart"><span class="hs-identifier hs-type">Chart</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Parser.CCG.html#Node"><span class="hs-identifier hs-type">CCG.Node</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Parser.CCG.html#Node"><span class="hs-identifier hs-type">CCG.Node</span></a><span class="hs-special">]</span><span>
</span><a name="line-164"></a><a name="checkParenthesisRule"><a href="Parser.ChartParser.html#checkParenthesisRule"><span class="hs-identifier">checkParenthesisRule</span></a></a><span> </span><a name="local-6989586621679088941"><a href="#local-6989586621679088941"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621679088942"><a href="#local-6989586621679088942"><span class="hs-identifier">j</span></a></a><span> </span><a name="local-6989586621679088943"><a href="#local-6989586621679088943"><span class="hs-identifier">chart</span></a></a><span> </span><a name="local-6989586621679088944"><a href="#local-6989586621679088944"><span class="hs-identifier">prevlist</span></a></a><span>
</span><a name="line-165"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679088941"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">3</span><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><a href="#local-6989586621679088942"><span class="hs-identifier hs-var">j</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679088945"><a href="#local-6989586621679088945"><span class="hs-identifier">accl</span></a></a><span> </span><a name="local-6989586621679088946"><a href="#local-6989586621679088946"><span class="hs-identifier">lnode</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679088947"><a href="#local-6989586621679088947"><span class="hs-identifier">accr</span></a></a><span> </span><a name="local-6989586621679088948"><a href="#local-6989586621679088948"><span class="hs-identifier">rnode</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679088949"><a href="#local-6989586621679088949"><span class="hs-identifier">accc</span></a></a><span> </span><a name="local-6989586621679088950"><a href="#local-6989586621679088950"><span class="hs-identifier">cnode</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Parser.CCG.html#parenthesisRule"><span class="hs-identifier hs-var">CCG.parenthesisRule</span></a><span> </span><a href="#local-6989586621679088946"><span class="hs-identifier hs-var">lnode</span></a><span> </span><a href="#local-6989586621679088950"><span class="hs-identifier hs-var">cnode</span></a><span> </span><a href="#local-6989586621679088948"><span class="hs-identifier hs-var">rnode</span></a><span> </span><a href="#local-6989586621679088949"><span class="hs-identifier hs-var">accc</span></a><span class="hs-special">)</span><span>
</span><a name="line-166"></a><span>                                                                    </span><a href="#local-6989586621679088947"><span class="hs-identifier hs-var">accr</span></a><span>
</span><a name="line-167"></a><span>                                                                    </span><span class="hs-special">(</span><a href="Parser.ChartParser.html#lookupChart"><span class="hs-identifier hs-var">lookupChart</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679088941"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679088942"><span class="hs-identifier hs-var">j</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679088943"><span class="hs-identifier hs-var">chart</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-168"></a><span>                                             </span><a href="#local-6989586621679088945"><span class="hs-identifier hs-var">accl</span></a><span>
</span><a name="line-169"></a><span>                                             </span><span class="hs-special">(</span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679088951"><a href="#local-6989586621679088951"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">CCG.cat</span><span> </span><a href="#local-6989586621679088951"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span class="hs-operator hs-var">==</span><a href="Parser.CCG.html#RPAREN"><span class="hs-identifier hs-var">CCG.RPAREN</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Parser.ChartParser.html#lookupChart"><span class="hs-identifier hs-var">lookupChart</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679088942"><span class="hs-identifier hs-var">j</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679088942"><span class="hs-identifier hs-var">j</span></a><span> </span><a href="#local-6989586621679088943"><span class="hs-identifier hs-var">chart</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-170"></a><span>                      </span><a href="#local-6989586621679088944"><span class="hs-identifier hs-var">prevlist</span></a><span>
</span><a name="line-171"></a><span>                      </span><span class="hs-special">(</span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679088952"><a href="#local-6989586621679088952"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">CCG.cat</span><span> </span><a href="#local-6989586621679088952"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span class="hs-operator hs-var">==</span><a href="Parser.CCG.html#LPAREN"><span class="hs-identifier hs-var">CCG.LPAREN</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Parser.ChartParser.html#lookupChart"><span class="hs-identifier hs-var">lookupChart</span></a><span> </span><a href="#local-6989586621679088941"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679088941"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679088943"><span class="hs-identifier hs-var">chart</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-172"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679088944"><span class="hs-identifier hs-var">prevlist</span></a><span>
</span><a name="line-173"></a><span>
</span><a name="line-174"></a><span class="hs-identifier">checkEmptyCategories</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Parser.CCG.html#Node"><span class="hs-identifier hs-type">CCG.Node</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Parser.CCG.html#Node"><span class="hs-identifier hs-type">CCG.Node</span></a><span class="hs-special">]</span><span>
</span><a name="line-175"></a><a name="checkEmptyCategories"><a href="Parser.ChartParser.html#checkEmptyCategories"><span class="hs-identifier">checkEmptyCategories</span></a></a><span> </span><a name="local-6989586621679088953"><a href="#local-6989586621679088953"><span class="hs-identifier">prevlist</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-176"></a><span>  </span><span class="hs-identifier hs-var">foldl'</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679088954"><a href="#local-6989586621679088954"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621679088955"><a href="#local-6989586621679088955"><span class="hs-identifier">ec</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679088956"><a href="#local-6989586621679088956"><span class="hs-identifier">list</span></a></a><span> </span><a name="local-6989586621679088957"><a href="#local-6989586621679088957"><span class="hs-identifier">node</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Parser.CCG.html#binaryRules"><span class="hs-identifier hs-var">CCG.binaryRules</span></a><span> </span><a href="#local-6989586621679088957"><span class="hs-identifier hs-var">node</span></a><span> </span><a href="#local-6989586621679088955"><span class="hs-identifier hs-var">ec</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><a href="Parser.CCG.html#binaryRules"><span class="hs-identifier hs-var">CCG.binaryRules</span></a><span> </span><a href="#local-6989586621679088955"><span class="hs-identifier hs-var">ec</span></a><span> </span><a href="#local-6989586621679088957"><span class="hs-identifier hs-var">node</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679088956"><span class="hs-identifier hs-var">list</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679088954"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679088954"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679088953"><span class="hs-identifier hs-var">prevlist</span></a><span> </span><a href="Parser.Japanese.MyLexicon.html#emptyCategories"><span class="hs-identifier hs-var">L.emptyCategories</span></a><span>
</span><a name="line-177"></a><span>
</span><a name="line-178"></a><span class="hs-comment">{- Partial Parsing -}</span><span>
</span><a name="line-179"></a><span>
</span><a name="line-180"></a><span class="hs-comment">-- | Simple parsing function to return just the best node for a given sentence</span><span>
</span><a name="line-181"></a><span class="hs-identifier">simpleParse</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">T.Text</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Parser.CCG.html#Node"><span class="hs-identifier hs-type">CCG.Node</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-182"></a><a name="simpleParse"><a href="Parser.ChartParser.html#simpleParse"><span class="hs-identifier">simpleParse</span></a></a><span> </span><a name="local-6989586621679088958"><a href="#local-6989586621679088958"><span class="hs-identifier">beam</span></a></a><span> </span><a name="local-6989586621679088959"><a href="#local-6989586621679088959"><span class="hs-identifier">sentence</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-183"></a><span>  </span><a name="local-6989586621679088960"><a href="#local-6989586621679088960"><span class="hs-identifier">chart</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Parser.ChartParser.html#parse"><span class="hs-identifier hs-var">parse</span></a><span> </span><a href="#local-6989586621679088958"><span class="hs-identifier hs-var">beam</span></a><span> </span><a href="#local-6989586621679088959"><span class="hs-identifier hs-var">sentence</span></a><span>
</span><a name="line-184"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="Parser.ChartParser.html#extractParseResult"><span class="hs-identifier hs-var">extractParseResult</span></a><span> </span><a href="#local-6989586621679088958"><span class="hs-identifier hs-var">beam</span></a><span> </span><a href="#local-6989586621679088960"><span class="hs-identifier hs-var">chart</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-185"></a><span>    </span><a href="Parser.ChartParser.html#Full"><span class="hs-identifier hs-var">Full</span></a><span> </span><a name="local-6989586621679088961"><a href="#local-6989586621679088961"><span class="hs-identifier">nodes</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679088961"><span class="hs-identifier hs-var">nodes</span></a><span>
</span><a name="line-186"></a><span>    </span><a href="Parser.ChartParser.html#Partial"><span class="hs-identifier hs-var">Partial</span></a><span> </span><a name="local-6989586621679088962"><a href="#local-6989586621679088962"><span class="hs-identifier">nodes</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679088962"><span class="hs-identifier hs-var">nodes</span></a><span>
</span><a name="line-187"></a><span>    </span><a href="Parser.ChartParser.html#Failed"><span class="hs-identifier hs-var">Failed</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-188"></a><span>
</span><a name="line-189"></a><span class="hs-comment">-- | A data type for the parsing result.</span><span>
</span><a name="line-190"></a><span class="hs-keyword">data</span><span> </span><a name="ParseResult"><a href="Parser.ChartParser.html#ParseResult"><span class="hs-identifier">ParseResult</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-191"></a><span>  </span><a name="Full"><a href="Parser.ChartParser.html#Full"><span class="hs-identifier">Full</span></a></a><span> </span><span class="hs-special">[</span><a href="Parser.CCG.html#Node"><span class="hs-identifier hs-type">CCG.Node</span></a><span class="hs-special">]</span><span>      </span><span class="hs-comment">-- ^ when there are at least one node in the topmost box in the chart, returning the nodes.</span><span>
</span><a name="line-192"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="Partial"><a href="Parser.ChartParser.html#Partial"><span class="hs-identifier">Partial</span></a></a><span> </span><span class="hs-special">[</span><a href="Parser.CCG.html#Node"><span class="hs-identifier hs-type">CCG.Node</span></a><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ when the parser did not obtain the full result, it collects partially parsed segments from the chart, returning their conjunctions.</span><span>
</span><a name="line-193"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="Failed"><a href="Parser.ChartParser.html#Failed"><span class="hs-identifier">Failed</span></a></a><span>             </span><span class="hs-comment">-- ^ when no box in the chart contains any node.</span><span>
</span><a name="line-194"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-195"></a><span>
</span><a name="line-196"></a><span class="hs-comment">-- | takes a (parse result) chart and returns a list consisting of nodes, partially parsed substrings.</span><span>
</span><a name="line-197"></a><span class="hs-identifier">extractParseResult</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Parser.ChartParser.html#Chart"><span class="hs-identifier hs-type">Chart</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Parser.ChartParser.html#ParseResult"><span class="hs-identifier hs-type">ParseResult</span></a><span>
</span><a name="line-198"></a><a name="extractParseResult"><a href="Parser.ChartParser.html#extractParseResult"><span class="hs-identifier">extractParseResult</span></a></a><span> </span><a name="local-6989586621679088963"><a href="#local-6989586621679088963"><span class="hs-identifier">beam</span></a></a><span> </span><a name="local-6989586621679088964"><a href="#local-6989586621679088964"><span class="hs-identifier">chart</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-199"></a><span>  </span><a href="#local-6989586621679088965"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">L.sortBy</span><span> </span><a href="Parser.ChartParser.html#isLessPrivilegedThan"><span class="hs-identifier hs-var">isLessPrivilegedThan</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">,</span><a name="local-6989586621679088979"><a href="#local-6989586621679088979"><span class="hs-identifier">nodes</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L.null</span><span> </span><a href="#local-6989586621679088979"><span class="hs-identifier hs-var">nodes</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">M.toList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679088964"><span class="hs-identifier hs-var">chart</span></a><span>
</span><a name="line-200"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679088965"><a href="#local-6989586621679088965"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Parser.ChartParser.html#Failed"><span class="hs-identifier hs-var">Failed</span></a><span>
</span><a name="line-201"></a><span>        </span><span class="hs-identifier">f</span><span> </span><a name="local-6989586621679088967"><a href="#local-6989586621679088967"><span class="hs-identifier">c</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679088968"><a href="#local-6989586621679088968"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">,</span><a name="local-6989586621679088969"><a href="#local-6989586621679088969"><span class="hs-identifier">nodes</span></a></a><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679088968"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Parser.ChartParser.html#Full"><span class="hs-identifier hs-var">Full</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Parser.CCG.html#wrapNode"><span class="hs-identifier hs-var">CCG.wrapNode</span></a><span> </span><span class="hs-special">(</span><a href="Parser.ChartParser.html#sortByNumberOfArgs"><span class="hs-identifier hs-var">sortByNumberOfArgs</span></a><span> </span><a href="#local-6989586621679088969"><span class="hs-identifier hs-var">nodes</span></a><span class="hs-special">)</span><span>
</span><a name="line-202"></a><span>                              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Parser.ChartParser.html#Partial"><span class="hs-identifier hs-var">Partial</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679088966"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Parser.CCG.html#wrapNode"><span class="hs-identifier hs-var">CCG.wrapNode</span></a><span> </span><span class="hs-special">(</span><a href="Parser.ChartParser.html#sortByNumberOfArgs"><span class="hs-identifier hs-var">sortByNumberOfArgs</span></a><span> </span><a href="#local-6989586621679088969"><span class="hs-identifier hs-var">nodes</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679088970"><a href="#local-6989586621679088970"><span class="hs-identifier">j</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679088970"><span class="hs-identifier hs-var">j</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><a href="#local-6989586621679088968"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679088967"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-203"></a><span>        </span><a name="local-6989586621679088966"><a href="#local-6989586621679088966"><span class="hs-identifier">g</span></a></a><span> </span><a name="local-6989586621679088971"><a href="#local-6989586621679088971"><span class="hs-identifier">results</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679088971"><span class="hs-identifier hs-var">results</span></a><span>
</span><a name="line-204"></a><span>        </span><span class="hs-identifier">g</span><span> </span><a name="local-6989586621679088972"><a href="#local-6989586621679088972"><span class="hs-identifier">results</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679088973"><a href="#local-6989586621679088973"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">,</span><a name="local-6989586621679088974"><a href="#local-6989586621679088974"><span class="hs-identifier">nodes</span></a></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a name="local-6989586621679088975"><a href="#local-6989586621679088975"><span class="hs-identifier">cs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679088966"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">take</span><span> </span><a href="#local-6989586621679088963"><span class="hs-identifier hs-var">beam</span></a><span> </span><span class="hs-special">[</span><a href="Parser.CCG.html#conjoinNodes"><span class="hs-identifier hs-var">CCG.conjoinNodes</span></a><span> </span><a href="#local-6989586621679088976"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679088977"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679088976"><a href="#local-6989586621679088976"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Parser.CCG.html#wrapNode"><span class="hs-identifier hs-var">CCG.wrapNode</span></a><span> </span><a href="#local-6989586621679088974"><span class="hs-identifier hs-var">nodes</span></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679088977"><a href="#local-6989586621679088977"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679088972"><span class="hs-identifier hs-var">results</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679088978"><a href="#local-6989586621679088978"><span class="hs-identifier">j</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679088978"><span class="hs-identifier hs-var">j</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><a href="#local-6989586621679088973"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679088975"><span class="hs-identifier hs-var">cs</span></a><span>
</span><a name="line-205"></a><span>
</span><a name="line-206"></a><span class="hs-comment">-- | a `isLessPriviledgedThan` b means that b is more important parse result than a.</span><span>
</span><a name="line-207"></a><span class="hs-identifier">isLessPrivilegedThan</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span class="hs-special">,</span><a href="#local-6989586621679088560"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span class="hs-special">,</span><a href="#local-6989586621679088560"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ordering</span><span>
</span><a name="line-208"></a><a name="isLessPrivilegedThan"><a href="Parser.ChartParser.html#isLessPrivilegedThan"><span class="hs-identifier">isLessPrivilegedThan</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679088980"><a href="#local-6989586621679088980"><span class="hs-identifier">i1</span></a></a><span class="hs-special">,</span><a name="local-6989586621679088981"><a href="#local-6989586621679088981"><span class="hs-identifier">j1</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679088982"><a href="#local-6989586621679088982"><span class="hs-identifier">i2</span></a></a><span class="hs-special">,</span><a name="local-6989586621679088983"><a href="#local-6989586621679088983"><span class="hs-identifier">j2</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679088980"><span class="hs-identifier hs-var">i1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679088982"><span class="hs-identifier hs-var">i2</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679088981"><span class="hs-identifier hs-var">j1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679088983"><span class="hs-identifier hs-var">j2</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">EQ</span><span>
</span><a name="line-209"></a><span>                                             </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679088983"><span class="hs-identifier hs-var">j2</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="#local-6989586621679088981"><span class="hs-identifier hs-var">j1</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">GT</span><span>
</span><a name="line-210"></a><span>                                             </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679088981"><span class="hs-identifier hs-var">j1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679088983"><span class="hs-identifier hs-var">j2</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679088982"><span class="hs-identifier hs-var">i2</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="#local-6989586621679088980"><span class="hs-identifier hs-var">i1</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">GT</span><span>
</span><a name="line-211"></a><span>                                             </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">LT</span><span>
</span><a name="line-212"></a><span>
</span><a name="line-213"></a><span class="hs-identifier">sortByNumberOfArgs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Parser.CCG.html#Node"><span class="hs-identifier hs-type">CCG.Node</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Parser.CCG.html#Node"><span class="hs-identifier hs-type">CCG.Node</span></a><span class="hs-special">]</span><span>
</span><a name="line-214"></a><a name="sortByNumberOfArgs"><a href="Parser.ChartParser.html#sortByNumberOfArgs"><span class="hs-identifier">sortByNumberOfArgs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">L.sortOn</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679088984"><a href="#local-6989586621679088984"><span class="hs-identifier">node</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Parser.ChartParser.html#numberOfArgs"><span class="hs-identifier hs-var">numberOfArgs</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">CCG.cat</span><span> </span><a href="#local-6989586621679088984"><span class="hs-identifier hs-var">node</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679088984"><span class="hs-identifier hs-var">node</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-215"></a><span>
</span><a name="line-216"></a><span class="hs-comment">-- | receives a category and returns an integer based on the number of arguments of the category, which is used for sorting nodes with respect to which node is considered to be a better result of the parsing.  Lesser is better, but non-propositional categories (such as NP, CONJ, LPAREN and RPAREN) are the worst (=10) even if they take no arguments.</span><span>
</span><a name="line-217"></a><span class="hs-identifier">numberOfArgs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Parser.CCG.html#Cat"><span class="hs-identifier hs-type">CCG.Cat</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-218"></a><a name="numberOfArgs"><a href="Parser.ChartParser.html#numberOfArgs"><span class="hs-identifier">numberOfArgs</span></a></a><span> </span><a name="local-6989586621679088985"><a href="#local-6989586621679088985"><span class="hs-identifier">node</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679088985"><span class="hs-identifier hs-var">node</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-219"></a><span>  </span><a href="Parser.CCG.html#SL"><span class="hs-identifier hs-var">CCG.SL</span></a><span> </span><a name="local-6989586621679088986"><a href="#local-6989586621679088986"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Parser.ChartParser.html#numberOfArgs"><span class="hs-identifier hs-var">numberOfArgs</span></a><span> </span><a href="#local-6989586621679088986"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-220"></a><span>  </span><a href="Parser.CCG.html#BS"><span class="hs-identifier hs-var">CCG.BS</span></a><span> </span><a name="local-6989586621679088987"><a href="#local-6989586621679088987"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Parser.ChartParser.html#numberOfArgs"><span class="hs-identifier hs-var">numberOfArgs</span></a><span> </span><a href="#local-6989586621679088987"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-221"></a><span>  </span><a href="Parser.CCG.html#T"><span class="hs-identifier hs-var">CCG.T</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679088988"><a href="#local-6989586621679088988"><span class="hs-identifier">c</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Parser.ChartParser.html#numberOfArgs"><span class="hs-identifier hs-var">numberOfArgs</span></a><span> </span><a href="#local-6989586621679088988"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-222"></a><span>  </span><a href="Parser.CCG.html#S"><span class="hs-identifier hs-var">CCG.S</span></a><span> </span><span class="hs-identifier">_</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-223"></a><span>  </span><a href="Parser.CCG.html#NP"><span class="hs-identifier hs-var">CCG.NP</span></a><span> </span><span class="hs-identifier">_</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">10</span><span>
</span><a name="line-224"></a><span>  </span><a href="Parser.CCG.html#Sbar"><span class="hs-identifier hs-var">CCG.Sbar</span></a><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-225"></a><span>  </span><a href="Parser.CCG.html#N"><span class="hs-identifier hs-var">CCG.N</span></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">2</span><span>
</span><a name="line-226"></a><span>  </span><a href="Parser.CCG.html#CONJ"><span class="hs-identifier hs-var">CCG.CONJ</span></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">100</span><span>
</span><a name="line-227"></a><span>  </span><a href="Parser.CCG.html#LPAREN"><span class="hs-identifier hs-var">CCG.LPAREN</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">100</span><span>
</span><a name="line-228"></a><span>  </span><a href="Parser.CCG.html#RPAREN"><span class="hs-identifier hs-var">CCG.RPAREN</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">100</span><span>
</span><a name="line-229"></a><span>
</span><a name="line-230"></a><span class="hs-comment">{-
sortByNumberOfArgs = sortByNumberOfArgsLoop 20 []

sortByNumberOfArgsLoop :: Int           -- ^ If a node whose number of args exceed this threshold will be discarded.
                          -&gt; [CCG.Node] -- ^ Nodes selected so far.
                          -&gt; [CCG.Node] -- ^ Given set of nodes to filter.
                          -&gt; [CCG.Node]
sortByNumberOfArgsLoop threshold selected nodes = case nodes of
  [] -&gt; L.sort selected
  (n:ns) -&gt; let numOfArg = (CCG.numberOfArgs . CCG.cat) n in
            case () of  
              _ | numOfArg &lt; threshold -&gt; sortByNumberOfArgsLoop numOfArg [n] ns          -- discard the selected ones and update threshold
                | threshold &lt; numOfArg -&gt; sortByNumberOfArgsLoop threshold selected ns    -- ignore n and proceed
                | otherwise            -&gt; sortByNumberOfArgsLoop numOfArg (n:selected) ns -- noa = threshold.  Add n to the selected ones and proceed.
-}</span><span>
</span><a name="line-245"></a><span>
</span><a name="line-246"></a><span class="hs-comment">{--
-- | takes only the nodes with the best score.
-- 'nodes' needs to be sorted before applying 'bestOnly' (e.g. bestOnly $ L.sort nodes)
bestOnly :: [CCG.Node] -&gt; [CCG.Node]
bestOnly nodes = case nodes of
  [] -&gt; []
  (firstnode:ns) -&gt; firstnode:(takeWhile (\node -&gt; CCG.score(node) &gt;= CCG.score(firstnode)) ns)
--}</span><span>
</span><a name="line-254"></a><span>
</span><a name="line-255"></a><span class="hs-comment">--orCONJ :: T.Text -&gt; CCG.Node</span><span>
</span><a name="line-256"></a><span class="hs-comment">--orCONJ c = LT.lexicalitem c &quot;new&quot; 100 CCG.CONJ LT.orSR</span><span>
</span><a name="line-257"></a><span>
</span><a name="line-258"></a><span class="hs-comment">{-
punctFilter i chartList e@((from,to),nodes)
  | to == i = let filterednodes = Maybe.catMaybes $ map (\n -&gt; case CCG.unifyWithHead [] [] LT.anySExStem (CCG.cat n) of 
                                                                 Nothing -&gt; CCG.unifyWithHead [] [] N (CCG.cat n) of
                                                                              Nothing -&gt; Nothing
                                                                              _ -&gt; Just n
                                                                 _ -&gt; Just n) nodes
              in ((from,to+1),filterednodes):(e:chartList)
  | otherwise = e:chartList
-}</span><span>
</span><a name="line-268"></a><span>
</span><a name="line-269"></a><span class="hs-comment">{-
punctFilter :: Int -&gt; Int -&gt; [((Int,Int),[CCG.Node])] -&gt; ((Int,Int),[CCG.Node]) -&gt; [((Int,Int),[CCG.Node])]
punctFilter sep i chartList e@((from,to),nodes)
  | to == i = if from &lt;= sep 
                 then ((from,to+1),nodes):(e:chartList)
                 else chartList
  | otherwise = if from &lt; sep
                  then e:chartList
                  else chartList
-}</span><span>
</span><a name="line-279"></a><span>
</span><a name="line-280"></a></pre></body></html>